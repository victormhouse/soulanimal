<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµé­‚æ –æ¯åœ° | åŠ¨ç‰©å¡‘æ€§æ ¼æµ‹è¯•</title>
    
    <link rel="preload" href="quiz_data_advanced.js" as="script">
    <link rel="preload" href="quiz_data_60.js" as="script">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="quiz_data_advanced.js"></script>
    <script src="quiz_data_60.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #eef2f5; /* æ•´ä½“èƒŒæ™¯æ”¹æ·¡ä¸€ç‚¹ï¼Œçªå‡ºå¡ç‰‡ */
            color: #2c3e50;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .serif { font-family: 'Noto Serif SC', serif; }
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1); }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* æ ¸å¿ƒæµ·æŠ¥å®¹å™¨ */
        .poster-card {
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
        }

        /* å™ªç‚¹çº¹ç†ï¼ˆå¢åŠ çº¸è´¨æ„Ÿï¼‰ */
        .texture-overlay {
            position: absolute;
            inset: 0;
            opacity: 0.4;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 1;
        }

        /* æ¯›ç»ç’ƒæ‚¬æµ®å±‚ */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255,255,255,0.6);
            box-shadow: 0 -10px 30px rgba(0,0,0,0.05);
        }

        /* è£…é¥°æ€§å…‰æ–‘ */
        .glow-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.6;
            z-index: 0;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* é€‰é¡¹æŒ‰é’®åŠ¨ç”» */
        .option-btn:active { transform: scale(0.98); }
        .progress-bar-fill { transition: width 0.5s ease-out; }

        /* Error Toast */
        .error-toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #ef4444; color: white; padding: 12px 20px;
            border-radius: 8px; z-index: 1000; display: none; font-size: 14px;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="error-toast" class="error-toast"></div>

    <div id="page-landing" class="w-full max-w-md bg-white rounded-[2rem] p-8 shadow-xl text-center fade-in flex flex-col justify-center min-h-[600px] relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-green-600 to-teal-600"></div>
        
        <div class="mb-10 relative z-10">
            <span class="inline-block px-4 py-1.5 bg-green-50 text-green-700 text-[10px] font-bold rounded-full tracking-[0.2em] mb-6 border border-green-100">SOUL HABITAT</span>
            <h1 class="text-4xl font-bold serif text-gray-900 mb-3 tracking-tight">çµé­‚æ –æ¯åœ°</h1>
            <p class="text-gray-400 text-sm tracking-wide">æ¢å¯»ä½ å†…å¿ƒæ·±å¤„çš„åŠ¨ç‰©åŸå‹</p>
        </div>
        
        <div class="my-auto relative group cursor-default">
            <div class="absolute inset-0 bg-green-100 rounded-full blur-3xl opacity-20 group-hover:opacity-30 transition duration-700"></div>
            <p class="serif text-lg leading-loose text-gray-600 italic relative z-10 px-4">
                "æ¯ä¸ªäººå¿ƒä¸­éƒ½ä½ç€ä¸€åªé‡å…½ã€‚<br>
                å®ƒåœ¨å­¤ç‹¬æ—¶è‹é†’ï¼Œ<br>
                åœ¨å–§åš£ä¸­æ²‰ç¡ã€‚"
            </p>
        </div>

        <div class="space-y-4 mt-auto relative z-10">
            <div class="grid grid-cols-2 gap-3">
                <button onclick="startQuiz('short')" class="bg-gray-900 text-white py-4 rounded-2xl font-medium hover:bg-black transition shadow-lg flex flex-col items-center justify-center gap-1 group">
                    <span class="text-sm font-bold">å¼€å§‹æ—…ç¨‹</span>
                    <span class="text-[10px] opacity-60 group-hover:opacity-100 transition">å¿«é€Ÿæµ‹è¯• (20é¢˜)</span>
                </button>
                <button onclick="startQuiz('long')" class="bg-white border-2 border-gray-100 text-gray-800 py-4 rounded-2xl font-medium hover:border-gray-300 transition flex flex-col items-center justify-center gap-1 group">
                    <span class="text-sm font-bold">æ·±åº¦æ¢ç´¢</span>
                    <span class="text-[10px] text-gray-400 group-hover:text-gray-600 transition">å®Œæ•´åˆ†æ (60é¢˜)</span>
                </button>
            </div>
            <button onclick="showPokedex()" class="w-full text-gray-400 text-xs py-3 hover:text-gray-600 transition flex items-center justify-center gap-1">
                æŸ¥çœ‹å…¨å›¾é‰´ (24ç§)
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
        </div>
    </div>

    <div id="page-quiz" class="hidden w-full max-w-md bg-white rounded-[2rem] p-8 shadow-xl flex-col min-h-[600px] relative">
        <div class="w-full h-1.5 bg-gray-100 rounded-full mb-8 overflow-hidden">
            <div id="progress-bar" class="h-full bg-gray-900 w-0 progress-bar-fill"></div>
        </div>

        <div class="flex-1 flex flex-col fade-in">
            <span class="text-xs font-bold text-gray-300 tracking-widest mb-4 block" id="quiz-progress-text">QUESTION 01</span>
            <h2 id="question-text" class="text-xl serif font-bold text-gray-800 mb-10 leading-relaxed">
                é¢˜ç›®åŠ è½½ä¸­...
            </h2>
            <div id="options-container" class="space-y-3">
                </div>
        </div>

        <div class="mt-8 flex justify-between items-center opacity-0 transition-opacity" id="quiz-controls">
            <button onclick="prevQuestion()" class="text-gray-400 hover:text-gray-900 text-xs font-bold uppercase tracking-wider flex items-center gap-2 px-2 py-2">
                â† Back
            </button>
            <button onclick="backToHome()" class="text-gray-300 hover:text-red-400 text-xs">é€€å‡º</button>
        </div>
    </div>

    <div id="page-loading" class="hidden w-full max-w-md bg-white rounded-[2rem] p-8 shadow-xl flex-col items-center justify-center text-center min-h-[600px]">
        <div class="relative w-20 h-20 mb-8">
            <div class="absolute inset-0 border-4 border-gray-100 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-gray-900 rounded-full border-t-transparent animate-spin"></div>
        </div>
        <h3 class="serif text-xl text-gray-900 mb-3 font-bold">æ­£åœ¨ç»˜åˆ¶çµé­‚ç”»åƒ</h3>
        <p id="loading-text" class="text-xs text-gray-400 tracking-widest uppercase">Analyzing Data...</p>
    </div>

    <div id="page-result" class="hidden w-full max-w-md rounded-[2rem] overflow-hidden poster-card fade-in relative min-h-[700px]">
        
        <div id="poster-bg" class="absolute inset-0 bg-gradient-to-b from-gray-200 to-gray-400 transition-colors duration-700"></div>
        
        <div class="texture-overlay"></div>

        <div class="glow-blob bg-white w-64 h-64 -top-10 -right-10 mix-blend-overlay"></div>
        <div class="glow-blob bg-black w-64 h-64 bottom-0 left-0 opacity-10"></div>

        <div class="relative h-full flex flex-col z-10">
            
            <div class="flex-1 flex flex-col items-center justify-center p-8 pb-12 text-center text-white">
                <div class="mb-4 animate-[bounce_3s_infinite]">
                    <span id="result-icon" class="text-7xl drop-shadow-2xl filter">âœ¨</span>
                </div>
                <h1 id="result-animal" class="text-5xl font-bold serif mb-2 drop-shadow-md tracking-wider">åŠ¨ç‰©å</h1>
                <div class="flex items-center gap-3 opacity-90">
                    <div class="h-[1px] w-8 bg-white/50"></div>
                    <p id="result-slogan" class="text-sm font-light tracking-widest uppercase">Slogan</p>
                    <div class="h-[1px] w-8 bg-white/50"></div>
                </div>
                
                <div id="result-tags" class="flex flex-wrap justify-center gap-2 mt-6">
                    </div>
            </div>

            <div class="glass-panel rounded-t-[2.5rem] p-8 pb-10 flex flex-col gap-6 transform translate-y-2">
                
                <div class="text-center">
                    <div class="w-10 h-1 bg-gray-300 rounded-full mx-auto mb-6 opacity-50"></div>
                    <p id="result-desc" class="text-gray-600 text-sm leading-7 font-light text-justify">
                        æè¿°æ–‡æœ¬...
                    </p>
                </div>

                <div class="relative">
                    <h3 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest text-center mb-4">Dimension</h3>
                    <div class="radar-container relative h-40">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-50/80 rounded-2xl p-4 text-center border border-gray-100">
                        <p class="text-[10px] text-gray-400 uppercase tracking-wider mb-1">Soul Mate</p>
                        <div class="text-2xl mb-1" id="result-match-icon">â¤ï¸</div>
                        <p id="result-match" class="font-bold text-gray-700 text-sm">Matches</p>
                    </div>
                    <div class="bg-gray-50/80 rounded-2xl p-4 text-center border border-gray-100">
                        <p class="text-[10px] text-gray-400 uppercase tracking-wider mb-1">Conflict</p>
                        <div class="text-2xl mb-1" id="result-enemy-icon">âš¡</div>
                        <p id="result-enemy" class="font-bold text-gray-700 text-sm">Enemies</p>
                    </div>
                </div>

                <div class="pt-2 space-y-3">
                    <button onclick="location.reload()" class="w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-sm tracking-wide hover:bg-black shadow-lg transition">
                        RESTART
                    </button>
                    <button onclick="showPokedex()" class="w-full text-gray-500 py-2 text-xs hover:text-gray-800 transition">
                        æŸ¥çœ‹å®Œæ•´å›¾é‰´
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="page-pokedex" class="hidden fixed inset-0 bg-gray-100/90 backdrop-blur-sm z-50 overflow-y-auto no-scrollbar">
        <div class="max-w-md mx-auto min-h-screen bg-white shadow-2xl">
            <div class="sticky top-0 bg-white/90 backdrop-blur-md p-5 border-b border-gray-100 flex items-center justify-between z-10">
                <div>
                    <h2 class="serif text-xl font-bold text-gray-900">å›¾é‰´</h2>
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest">Collection (24)</p>
                </div>
                <button onclick="closePokedex()" class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full hover:bg-gray-200 transition">
                    <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            
            <div class="p-5 grid grid-cols-1 gap-4" id="pokedex-grid">
                </div>
        </div>
    </div>

    <script>
        // --- 1. 24ç§åŠ¨ç‰©å®Œæ•´æ•°æ® ---
        // æ³¨æ„ï¼šä¸ºäº†è§†è§‰æ•ˆæœï¼Œæˆ‘åœ¨ color å­—æ®µä½¿ç”¨äº† Tailwind çš„æ¸å˜ç±»
        // å¹¶æ‰‹åŠ¨æ·»åŠ äº† hex é¢œè‰²ä¾›é›·è¾¾å›¾ä½¿ç”¨
        const animals = {
             // === 16ç§åŸºç¡€å‹ ===
            "snow_leopard": { // INTP
                name: "é›ªè±¹", icon: "ğŸ†",
                slogan: "å­¤é«˜çš„é›ªå±±å“²äºº",
                tags: ["ç‹¬ç«‹", "æå®¢", "è¾¹ç•Œæ„Ÿ"],
                color: "from-slate-700 to-slate-900", hex: "#334155",
                desc: "æ –æ¯åœ¨é›ªçº¿ä¹‹ä¸Šçš„å“²äººã€‚ä½ å¯¹ä¸–ç•Œçš„è¿è¡Œè§„å¾‹å……æ»¡å¥½å¥‡ï¼Œå–œæ¬¢ç‹¬è‡ªè§£æ„å¤æ‚é—®é¢˜ã€‚åœ¨ç¤¾äº¤ä¸­ï¼Œä½ æ˜¯è¯æœ€å°‘ä½†çœ‹å¾—æœ€é€çš„äººã€‚",
                match: "èµ¤ç‹", enemy: "é‡‘æ¯›"
            },
            "owl": { // INTJ
                name: "ä»“é¸®", icon: "ğŸ¦‰",
                slogan: "æš—å¤œçš„å®ˆæœ›è€…",
                tags: ["å…¨çŸ¥è§†è§’", "æˆ˜ç•¥å®¶", "é«˜å†·"],
                color: "from-indigo-900 to-slate-900", hex: "#312e81",
                desc: "æ™ºæ…§çš„åŒ–èº«ã€‚ä½ å´‡å°šé€»è¾‘å’Œæ•ˆç‡ï¼Œå¯¹å¹³åº¸é›¶å®¹å¿ã€‚ä½ åœ¨é»‘å¤œä¸­ä¿æŒç»å¯¹æ¸…é†’ï¼Œå†…å¿ƒæ„å»ºç€å®å¤§çš„æˆ˜ç•¥è“å›¾ã€‚",
                match: "æµ·è±š", enemy: "å­”é›€"
            },
            "lion": { // ENTJ
                name: "ç‹®å­", icon: "ğŸ¦",
                slogan: "è£è€€è’åŸçš„ç‹è€…",
                tags: ["éœ¸æ°”", "æŒæ§æ¬²", "ç›®æ ‡æ„Ÿ"],
                color: "from-yellow-700 to-red-900", hex: "#b45309",
                desc: "å¤©ç”Ÿçš„ä¸»è§’ã€‚ä½ æ‹¥æœ‰å¼ºå¤§çš„æ°”åœºå’Œé¢†å¯¼åŠ›ï¼Œèƒ½åœ¨æ··ä¹±ä¸­è¿…é€Ÿå»ºç«‹ç§©åºã€‚è™½ç„¶å¼ºåŠ¿ï¼Œä½†ä½ æå…¶æŠ¤çŸ­ã€‚",
                match: "æ—é¹¿", enemy: "æ°´è±š"
            },
            "fox": { // ENTP
                name: "èµ¤ç‹", icon: "ğŸ¦Š",
                slogan: "ç‹¡é» çš„ç ´å±€è€…",
                tags: ["æœºæ™º", "åéª¨", "åˆ›æ–°"],
                color: "from-orange-600 to-red-700", hex: "#ea580c",
                desc: "è§„åˆ™çš„æŒ‘æˆ˜è€…ã€‚ä½ æ€ç»´æ•æ·ï¼Œå–œæ¬¢ç”¨åˆé’»çš„è§’åº¦çœ‹é—®é¢˜ã€‚ä½ é­…åŠ›åè¶³ï¼Œå±é™©åˆè¿·äººï¼Œæ°¸è¿œæ²¡äººèƒ½çŒœé€ä½ çš„ä¸‹ä¸€å¼ ç‰Œã€‚",
                match: "é›ªè±¹", enemy: "å¤§è±¡"
            },
            "whale": { // INFJ
                name: "è“é²¸", icon: "ğŸ‹",
                slogan: "æ·±æµ·çš„å­¤ç‹¬ç¥çµ",
                tags: ["çµæ€§", "åŒ…å®¹", "æ´å¯ŸåŠ›"],
                color: "from-blue-900 to-indigo-900", hex: "#1e3a8a",
                desc: "çµé­‚å¤è€è€Œæ·±é‚ƒã€‚ä½ æ‹¥æœ‰æƒŠäººçš„ç›´è§‰ï¼Œèƒ½è½»æ˜“æ´å¯Ÿä¼ªè£…ã€‚ä½ çœ‹èµ·æ¥æ¸©æŸ”ï¼Œä½†å†…å¿ƒæœ‰ä¸€ç‰‡è°ä¹Ÿæ— æ³•æŠµè¾¾çš„å‡€åœŸã€‚",
                match: "èµ¤ç‹", enemy: "å­”é›€"
            },
            "deer": { // INFP
                name: "æ—é¹¿", icon: "ğŸ¦Œ",
                slogan: "è¿·é›¾æ£®æ—çš„è¯—äºº",
                tags: ["æ•æ„Ÿ", "æ–‡è‰º", "æ²»æ„ˆ"],
                color: "from-emerald-600 to-teal-800", hex: "#059669",
                desc: "å†…å¿ƒæ‹¥æœ‰ä¸€åº§ç§˜å¯†èŠ±å›­ã€‚ä½ å¯¹æƒ…ç»ªå’Œç¾éå¸¸æ•æ„Ÿã€‚è™½ç„¶ä¸å–„è¨€è¾ï¼Œä½†å†…å¿ƒæœ‰ç€ä¸°å¯Œçš„é“å¾·ç½—ç›˜ã€‚",
                match: "ç‹®å­", enemy: "é»‘é¹°"
            },
            "swan": { // ENFJ
                name: "é»‘å¤©é¹…", icon: "ğŸ¦¢",
                slogan: "ä¼˜é›…çš„ç²¾ç¥é¢†è¢–",
                tags: ["é­…åŠ›", "å¼•å¯¼è€…", "æ„ŸæŸ“åŠ›"],
                color: "from-gray-700 to-black", hex: "#1f2937",
                desc: "ç”Ÿæ¥å°±æ˜¯ä¸ºäº†å½±å“ä»–äººçš„ã€‚ä½ ä¸ä»…ä¼˜é›…ï¼Œæ›´æœ‰ä¸€ç§é¼“èˆäººå¿ƒçš„åŠ›é‡ã€‚ä½ æ˜¯å›¢é˜Ÿçš„ç²¾ç¥å›¾è…¾ã€‚",
                match: "æ—é¹¿", enemy: "é›ªè±¹"
            },
            "dolphin": { // ENFP
                name: "æµ·è±š", icon: "ğŸ¬",
                slogan: "è‡ªç”±çš„å¼„æ½®å„¿",
                tags: ["è„‘æ´", "è‡ªç”±", "å¼€å¿ƒæœ"],
                color: "from-cyan-500 to-blue-600", hex: "#06b6d4",
                desc: "æœ‰è¶£çš„çµé­‚ï¼Œè„‘æ´æ¯”é»‘æ´è¿˜å¤§ã€‚å¸¸è§„æ˜¯ä½ æœ€å¤§çš„æ•Œäººï¼Œä½ ä¸€ç”Ÿéƒ½åœ¨è¿½æ±‚æ–°é²œæ„Ÿã€‚ä½ æ˜¯å¤©ç”Ÿçš„ç¤¾äº¤æ˜æ˜Ÿã€‚",
                match: "ä»“é¸®", enemy: "é»‘é¹°"
            },
            "elephant": { // ISTJ
                name: "å¤§è±¡", icon: "ğŸ˜",
                slogan: "æ²‰é»˜çš„è´Ÿé‡è€…",
                tags: ["å¯é ", "ç¨³é‡", "è´£ä»»"],
                color: "from-stone-500 to-stone-700", hex: "#57534e",
                desc: "ä¸–é—´æœ€åšå®çš„ä¾é ã€‚ä½ è¯ä¸å¤šï¼Œä½†æ¯ä¸€å¥éƒ½ç®—æ•°ã€‚ä½ çš„çˆ±æ·±æ²‰è€Œåšé‡ï¼Œä¸€æ—¦è®¤å®šï¼Œä¾¿æ˜¯ä¸€ç”Ÿçš„å®ˆæŠ¤ã€‚",
                match: "å­”é›€", enemy: "èµ¤ç‹"
            },
            "penguin": { // ISFJ
                name: "ä¼é¹…", icon: "ğŸ§",
                slogan: "å†°åŸçš„å®ˆæŠ¤è€…",
                tags: ["å¿ è¯š", "å¥‰çŒ®", "åšéŸ§"],
                color: "from-sky-600 to-blue-800", hex: "#0284c7",
                desc: "ç”¨ä½“æ¸©æ¸©æš–èº«è¾¹çš„äººã€‚ä½ æå…¶é‡è§†æ‰¿è¯ºï¼Œä¸ºäº†ä¿æŠ¤åœ¨ä¹çš„äººå¯ä»¥å¿å—æç«¯ç¯å¢ƒã€‚ä½ æ˜¯ç»´ç³»ç¾¤ä½“æœ€é‡è¦çš„åŸºçŸ³ã€‚",
                match: "é»‘é¹°", enemy: "èµ¤ç‹"
            },
            "eagle": { // ESTJ
                name: "é»‘é¹°", icon: "ğŸ¦…",
                slogan: "å¤©ç©ºçš„ç§©åºå®˜",
                tags: ["ä¸¥å‰", "é«˜æ•ˆ", "æ‰§è¡Œ"],
                color: "from-neutral-700 to-black", hex: "#262626",
                desc: "ä¸€åˆ‡ä½æ•ˆéƒ½é€ƒä¸è¿‡ä½ çš„çœ¼ç›ã€‚ä½ ä¿¡å¥‰ä¼˜èƒœåŠ£æ±°ï¼Œé›·å‰é£è¡Œã€‚ä½ æ˜¯ç§©åºçš„ç»´æŠ¤è€…ï¼Œä¹Ÿæ˜¯æœ€å¯é çš„æŒ‡æŒ¥å®˜ã€‚",
                match: "ä¼é¹…", enemy: "æµ·è±š"
            },
            "golden_retriever": { // ESFJ
                name: "é‡‘æ¯›", icon: "ğŸ•",
                slogan: "æ²»æ„ˆç³»çš„å°å¤ªé˜³",
                tags: ["ç¤¾ç‰›", "å…±æƒ…", "æ¸©æš–"],
                color: "from-amber-400 to-orange-500", hex: "#f59e0b",
                desc: "æœ‹å‹åœˆçš„ç²˜åˆå‰‚ã€‚ä½ å¯¹æƒ…ç»ªæœ‰é›·è¾¾èˆ¬çš„æ„ŸçŸ¥åŠ›ï¼Œæ€»æŠŠç…§é¡¾åˆ«äººæ”¾åœ¨ç¬¬ä¸€ä½ã€‚ä½ æ˜¯å¤§å®¶å…¬è®¤çš„'æœ€ä½³ä¾é 'ã€‚",
                match: "æ°´è±š", enemy: "é›ªè±¹"
            },
            "octopus": { // ISTP
                name: "ç« é±¼", icon: "ğŸ™",
                slogan: "æ·±æ¸Šçš„æŠ€æœ¯æµ",
                tags: ["å¤šé¢æ‰‹", "å†·é™", "ç‹¬è¡Œ"],
                color: "from-violet-600 to-fuchsia-800", hex: "#7c3aed",
                desc: "å¤©ç”Ÿçš„é—®é¢˜è§£å†³ä¸“å®¶ã€‚æ‹¥æœ‰æå¼ºçš„å¥½å¥‡å¿ƒå’ŒåŠ¨æ‰‹èƒ½åŠ›ã€‚ä½ å†·é™ã€é«˜æ•ˆï¼Œå–„äºé€‚åº”ç¯å¢ƒï¼Œä½†ç»ä¸ä¾èµ–ä»»ä½•äººã€‚",
                match: "é‡‘æ¯›", enemy: "é»‘å¤©é¹…"
            },
            "capybara": { // ISFP
                name: "æ°´è±š", icon: "ğŸŠ",
                slogan: "ä½›ç³»çš„å…¥å®šå¤§å¸ˆ",
                tags: ["æƒ…ç»ªç¨³å®š", "éšç¼˜", "å’Œå¹³"],
                color: "from-green-500 to-emerald-700", hex: "#10b981",
                desc: "ç²¾ç¥çŠ¶æ€æå…¶ç¾ä¸½ã€‚æ‹¥æœ‰ä»¤äººç¾¡æ…•çš„'é’æ„ŸåŠ›'ï¼Œå¤–ç•Œçš„ç„¦è™‘å¾ˆéš¾å¹²æ‰°ä½ ã€‚ä½ æ˜¯æ‰€æœ‰ç„¦è™‘å‹äººæ ¼çš„è§£è¯ã€‚",
                match: "ç‹®å­", enemy: "é»‘é¹°"
            },
            "honey_badger": { // ESTP
                name: "èœœç¾", icon: "ğŸ¦¡",
                slogan: "æ— ç•çš„é€†è¡Œè€…",
                tags: ["ç¡¬åˆš", "è¡ŒåŠ¨æ´¾", "ç›´ç‡"],
                color: "from-orange-700 to-red-800", hex: "#c2410c",
                desc: "ç”Ÿæ­»çœ‹æ·¡ï¼Œä¸æœå°±å¹²ã€‚ä½ æœ€è®¨åŒè™šä¼ªï¼Œæ‹¥æœ‰æå¼ºçš„æŠ—å‹èƒ½åŠ›ã€‚ä½ æ´»åœ¨å½“ä¸‹ï¼Œäº«å—æŒ‘æˆ˜ï¼Œæ˜¯å¤©ç”Ÿçš„æˆ˜å£«ã€‚",
                match: "æ°´è±š", enemy: "æ—é¹¿"
            },
            "peacock": { // ESFP
                name: "å­”é›€", icon: "ğŸ¦š",
                slogan: "ç››å¤çš„ç‹‚æ¬¢è€…",
                tags: ["ç„¦ç‚¹", "ä¹å¤©", "é—ªè€€"],
                color: "from-pink-500 to-rose-600", hex: "#ec4899",
                desc: "ç”Ÿæ¥å°±è¯¥åœ¨èšå…‰ç¯ä¸‹ã€‚ä½ çš„å­˜åœ¨å°±æ˜¯ä¸€åœºæ¼”å‡ºã€‚è™½ç„¶æœ‰äººè§‰å¾—ä½ æµ®å¤¸ï¼Œä½†ä½ çš„å¿«ä¹çœŸå®ä¸”å…·æ„ŸæŸ“åŠ›ã€‚",
                match: "å¤§è±¡", enemy: "ä»“é¸®"
            },

            // === 8ç§ç‰¹æ®Š/å¹³è¡¡å‹ ===
            "maine_coon": { // E/Iå¹³è¡¡
                name: "ç¼…å› çŒ«", icon: "ğŸ±",
                slogan: "æ¸©æŸ”çš„å·¨äººç»…å£«",
                tags: ["é—´æ­‡ç¤¾æ", "å¤–å†·å†…çƒ­", "ç²˜äºº"],
                color: "from-stone-500 to-orange-400", hex: "#78716c",
                desc: "çŸ›ç›¾çš„ç»¼åˆä½“ã€‚æ‹¥æœ‰çŒ«çš„ç‹¬ç«‹ä¸ç‹—çš„å¿ è¯šã€‚ä½ åœ¨ç¤¾äº¤ä¸­æ¸¸åˆƒæœ‰ä½™ï¼Œä½†å†…å¿ƒå§‹ç»ˆä¿ç•™ç€ä¸€ä¸ªè°ä¹Ÿè¿›ä¸å»çš„è§’è½ã€‚",
                match: "é‡‘æ¯›", enemy: "é»‘é¹°"
            },
            "chameleon": { // E/Iå¹³è¡¡
                name: "å˜è‰²é¾™", icon: "ğŸ¦",
                slogan: "å…¨èƒ½çš„ç¤¾äº¤é»‘å®¢",
                tags: ["é€‚åº”åŠ›", "ä¼ªè£…", "å¤šé¢"],
                color: "from-lime-500 to-green-600", hex: "#84cc16",
                desc: "å¤©ç”Ÿçš„å¤–äº¤å®˜ã€‚ä½ å¯ä»¥æ— ç¼èå…¥ä»»ä½•åœˆå­ï¼Œä½†å¾ˆå°‘æœ‰äººèƒ½çœ‹é€ä½ çœŸå®çš„åº•è‰²ã€‚è¿™ç§èƒ½åŠ›è®©ä½ å®‰å…¨ï¼Œä¹Ÿè®©ä½ è¿·å¤±ã€‚",
                match: "è™é²¸", enemy: "é³„é±¼"
            },
            "orca": { // T/Få¹³è¡¡ (å¤–å‘)
                name: "è™é²¸", icon: "ğŸ¦ˆ",
                slogan: "æ·±æƒ…çš„æ·±æµ·éœ¸ä¸»",
                tags: ["é«˜æ™ºå•†", "å®¶æ—", "æŠ¤çŸ­"],
                color: "from-slate-800 to-black", hex: "#0f172a",
                desc: "ç†æ™ºä¸æƒ…æ„Ÿçš„å®Œç¾ç»“åˆã€‚å¯¹å¤–å±•ç°çŒæ‰‹çš„å†·é…·é€»è¾‘ï¼Œå¯¹å†…æœ‰ç€æ·±æƒ…çš„çº½å¸¦ã€‚èªæ˜ã€å¼ºå£®ä¸”è®°ä»‡ã€‚",
                match: "æµ·è±š", enemy: "å¤§è±¡"
            },
            "sea_turtle": { // T/Få¹³è¡¡ (å†…å‘)
                name: "æµ·é¾Ÿ", icon: "ğŸ¢",
                slogan: "æ²‰é»˜çš„è¿œèˆªæ™ºè€…",
                tags: ["æ…¢çƒ­", "æ™ºæ…§", "é•¿æƒ…"],
                color: "from-teal-600 to-cyan-800", hex: "#0d9488",
                desc: "åšç¡¬çš„ç†æ€§å¤–å£³ï¼ŒæŸ”è½¯æ„Ÿæ€§çš„å†…å¿ƒã€‚ä½ æ´»åœ¨è‡ªå·±çš„æ—¶åŒºé‡Œã€‚ä½ ç›¸ä¿¡æ—¶é—´çš„åŠ›é‡ï¼Œè¿½æ±‚é•¿ä¹…çš„é™ªä¼´ã€‚",
                match: "è“é²¸", enemy: "èœœç¾"
            },
            "squirrel": { // J/På¹³è¡¡
                name: "æ¾é¼ ", icon: "ğŸ¿ï¸",
                slogan: "æ•æ·çš„æ”¶è—å®¶",
                tags: ["æœªé›¨ç»¸ç¼ª", "ç„¦è™‘", "çµæ´»"],
                color: "from-amber-600 to-orange-700", hex: "#d97706",
                desc: "å†…å¿ƒå¤„äº'ç§©åº'ä¸'æ··ä¹±'çš„å åŠ æ€ã€‚ä½ å–œæ¬¢å›¤ç§¯ç‰©èµ„å¯¹æŠ—ä¸å®‰å…¨æ„Ÿã€‚ä½ æ˜¯ä¹±ä¸–ä¸­çš„ç”Ÿå­˜ä¸“å®¶ã€‚",
                match: "è€ƒæ‹‰", enemy: "ç‹®å­"
            },
            "koala": { // S/Nå¹³è¡¡
                name: "è€ƒæ‹‰", icon: "ğŸ¨",
                slogan: "æ¸…é†’çš„å…¥ä¸–éšå£«",
                tags: ["ä½›ç³»", "æ—è§‚", "æŒ‘å‰”"],
                color: "from-gray-400 to-slate-500", hex: "#94a3b8",
                desc: "çœ‹èµ·æ¥æ‡’æ´‹æ´‹ï¼Œå…¶å®æ˜¯åœ¨ç­›é€‰ä¸–ç•Œã€‚åªæœ‰è®©ä½ æ„Ÿåˆ°ç»å¯¹èˆ’é€‚çš„äººäº‹ç‰©ï¼Œä½ æ‰ä¼šç´§æŠ±ä¸æ”¾ã€‚ä½ æ´»å¾—æ¸…é†’é€šé€ã€‚",
                match: "æ¾é¼ ", enemy: "é³„é±¼"
            },
            "unicorn": { // æç«¯NF
                name: "ç‹¬è§’å…½", icon: "ğŸ¦„",
                slogan: "çº¯ç²¹çš„å¹»æƒ³ç”Ÿç‰©",
                tags: ["æè‡´ç†æƒ³", "çº¯æ´", "é«˜ç»´"],
                color: "from-fuchsia-300 to-purple-400", hex: "#d8b4fe",
                desc: "çº¯ç²¹å¾—ä¸åƒå‡¡é—´äº§ç‰©ã€‚ä½ æ˜¯æè‡´çš„ç†æƒ³ä¸»ä¹‰è€…ï¼Œå¯¹ç¾å’Œæ­£ä¹‰æœ‰æ´ç™–èˆ¬çš„è¿½æ±‚ã€‚ä½ çš„å­˜åœ¨æœ¬èº«å°±æ˜¯ä¸€ç§å‡€åŒ–ã€‚",
                match: "é›ªè±¹", enemy: "é³„é±¼"
            },
            "crocodile": { // æç«¯ST
                name: "é³„é±¼", icon: "ğŸŠ",
                slogan: "å†·é…·çš„ç”Ÿå­˜æœºå™¨",
                tags: ["ç°å®", "è€å¿ƒ", "å¼ºè€…"],
                color: "from-green-800 to-stone-800", hex: "#3f6212",
                desc: "ç»å¯¹çš„ç°å®ä¸»ä¹‰è€…ã€‚æ²¡æœ‰å¤šä½™æƒ…ç»ªï¼Œåªå…³æ³¨ç»“æœã€‚ä½ æ‹¥æœ‰å¯æ€•çš„è€å¿ƒï¼Œæ˜¯é£Ÿç‰©é“¾é¡¶ç«¯çš„å¼ºè€…ã€‚",
                match: "å˜è‰²é¾™", enemy: "ç‹¬è§’å…½"
            }
        };

        // --- 2. é€»è¾‘æ§åˆ¶ ---
        let currentQuestionIndex = 0;
        let scores = { E:0, I:0, S:0, N:0, T:0, F:0, J:0, P:0 };
        let historyStack = [];
        let currentQuizMode = 'short';
        let currentQuestions = [];

        function showPage(pageId) {
            document.querySelectorAll('body > div').forEach(div => {
                if(div.id.startsWith('page-')) div.classList.add('hidden');
                if(div.id === 'page-pokedex') div.classList.add('hidden');
            });
            const target = document.getElementById(pageId);
            target.classList.remove('hidden');
            if (pageId !== 'page-pokedex') target.classList.add('flex');
            window.scrollTo(0,0);
        }

        function showError(msg) {
            const toast = document.getElementById('error-toast');
            toast.textContent = msg;
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 5000);
        }

        function startQuiz(mode) {
            const questionsAvailable = typeof questions !== 'undefined';
            const questions60Available = typeof questions_60 !== 'undefined';
            if (mode === 'short' && !questionsAvailable) return showError('20é¢˜é¢˜åº“æœªåŠ è½½');
            if (mode === 'long' && !questions60Available) return showError('60é¢˜é¢˜åº“æœªåŠ è½½');

            currentQuizMode = mode;
            currentQuestions = mode === 'short' ? questions : questions_60;
            currentQuestionIndex = 0;
            scores = { E:0, I:0, S:0, N:0, T:0, F:0, J:0, P:0 };
            historyStack = [];
            
            showPage('page-quiz');
            renderQuestion();
        }

        function backToHome() {
            if(confirm("ç¡®å®šé€€å‡ºï¼Ÿè¿›åº¦å°†ä¸¢å¤±")) showPage('page-landing');
        }

        function renderQuestion() {
            const q = currentQuestions[currentQuestionIndex];
            const progress = ((currentQuestionIndex) / currentQuestions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('quiz-progress-text').innerText = `QUESTION ${String(currentQuestionIndex + 1).padStart(2, '0')}`;
            document.getElementById('question-text').innerText = q.q;

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left p-5 rounded-2xl border-2 border-gray-100 hover:border-gray-900 hover:bg-gray-50 transition duration-200 text-gray-700 text-sm font-medium leading-relaxed mb-3";
                btn.innerText = opt.t;
                btn.onclick = () => handleAnswer(opt.s);
                btn.style.animation = `fadeIn 0.5s ease forwards ${index * 0.1}s`;
                btn.style.opacity = '0';
                container.appendChild(btn);
            });

            const controls = document.getElementById('quiz-controls');
            if(currentQuestionIndex > 0) controls.classList.remove('opacity-0');
            else controls.classList.add('opacity-0');
        }

        function handleAnswer(scoreDelta) {
            historyStack.push({ ...scores });
            for (let key in scoreDelta) if (scores.hasOwnProperty(key)) scores[key] += scoreDelta[key];
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                finishQuiz();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0 && historyStack.length > 0) {
                scores = historyStack.pop();
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        function finishQuiz() {
            showPage('page-loading');
            const loadingTexts = ["æ•´åˆæ€ç»´ç¢ç‰‡...", "åˆ†æç¤¾äº¤ç£åœº...", "åŒ¹é…çµé­‚åŸå‹...", "ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š..."];
            let step = 0;
            const interval = setInterval(() => {
                if (step < loadingTexts.length) {
                    document.getElementById('loading-text').innerText = loadingTexts[step];
                    step++;
                }
            }, 600);
            setTimeout(() => { clearInterval(interval); calculateResult(); }, 2500);
        }

        // --- 3. ç®—æ³• ---
        function calculateResult() {
            const s = scores;
            const dim1 = s.E >= s.I ? 'E' : 'I';
            const dim2 = s.S >= s.N ? 'S' : 'N';
            const dim3 = s.T >= s.F ? 'T' : 'F';
            const dim4 = s.J >= s.P ? 'J' : 'P';
            const baseType = dim1 + dim2 + dim3 + dim4;

            const diffEI = Math.abs(s.E - s.I);
            const diffTF = Math.abs(s.T - s.F);
            const diffJP = Math.abs(s.J - s.P);
            const diffSN = Math.abs(s.S - s.N);

            let animalKey = "";

            if (dim2 === 'N' && dim3 === 'F' && diffSN > 4 && diffTF > 4) animalKey = "unicorn";
            else if (dim2 === 'S' && dim3 === 'T' && diffSN > 4 && diffTF > 4) animalKey = "crocodile";
            else if (diffTF <= 1 && dim1 === 'E') animalKey = "orca";
            else if (diffTF <= 1 && dim1 === 'I') animalKey = "sea_turtle";
            else if (diffEI <= 1 && dim3 === 'F') animalKey = "maine_coon";
            else if (diffEI <= 1 && dim3 === 'T') animalKey = "chameleon";
            else if (diffJP <= 1) animalKey = "squirrel";
            else if (diffSN <= 1) animalKey = "koala";
            else {
                const baseMap = {
                    "INTJ": "owl", "INTP": "snow_leopard", "ENTJ": "lion", "ENTP": "fox",
                    "INFJ": "whale", "INFP": "deer", "ENFJ": "swan", "ENFP": "dolphin",
                    "ISTJ": "elephant", "ISFJ": "penguin", "ESTJ": "eagle", "ESFJ": "golden_retriever",
                    "ISTP": "octopus", "ISFP": "capybara", "ESTP": "honey_badger", "ESFP": "peacock"
                };
                animalKey = baseMap[baseType];
            }

            if (!animalKey || !animals[animalKey]) animalKey = "capybara"; 
            renderResultPage(animalKey);
            showPage('page-result');
        }

        // --- 4. æ¸²æŸ“ (æµ·æŠ¥é£æ ¼) ---
        function renderResultPage(key) {
            const data = animals[key];
            
            // æ–‡æœ¬å’Œå›¾æ ‡å¡«å……
            document.getElementById('result-animal').innerText = data.name;
            document.getElementById('result-icon').innerText = data.icon;
            document.getElementById('result-slogan').innerText = data.slogan;
            document.getElementById('result-desc').innerText = data.desc;

            // åŒ¹é…å¯¹è±¡
            const matchData = animals[data.match] || {name: data.match, icon: 'â¤ï¸'};
            const enemyData = animals[data.enemy] || {name: data.enemy, icon: 'âš¡'};
            
            document.getElementById('result-match').innerText = matchData.name;
            document.getElementById('result-match-icon').innerText = matchData.icon;
            
            document.getElementById('result-enemy').innerText = enemyData.name;
            document.getElementById('result-enemy-icon').innerText = enemyData.icon;

            // æµ·æŠ¥èƒŒæ™¯è‰² (åº”ç”¨åˆ°æ•´ä¸ªå¡ç‰‡)
            const bg = document.getElementById('poster-bg');
            bg.className = `absolute inset-0 bg-gradient-to-b ${data.color} transition-colors duration-700`;

            // Tags
            const tagsContainer = document.getElementById('result-tags');
            tagsContainer.innerHTML = data.tags.map(t => 
                `<span class="px-3 py-1 bg-white/20 backdrop-blur-md border border-white/20 rounded-full text-[10px] text-white font-bold tracking-widest uppercase">${t}</span>`
            ).join('');

            renderRadarChart(data.hex);
        }

        let radarChartInstance = null;
        function renderRadarChart(colorHex) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const normalize = (val) => Math.min((val / 10) * 100, 100);
            const dataValues = [
                normalize(scores.E), normalize(scores.F), normalize(scores.N), normalize(scores.T), normalize(scores.J)
            ];

            if (radarChartInstance) radarChartInstance.destroy();

            // åŠ¨æ€è°ƒæ•´é›·è¾¾å›¾é¢œè‰²é€‚é…åŠ¨ç‰©
            const mainColor = colorHex || '#4b5563';

            radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ç¤¾äº¤', 'å…±æƒ…', 'æƒ³è±¡', 'é€»è¾‘', 'æ‰§è¡Œ'],
                    datasets: [{
                        data: dataValues,
                        backgroundColor: mainColor + '33', // 20% opacity
                        borderColor: mainColor,
                        borderWidth: 2,
                        pointBackgroundColor: mainColor,
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: mainColor
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(0,0,0,0.05)' },
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            pointLabels: { font: { size: 10, family: "'Noto Sans SC'" }, color: '#9ca3af' },
                            suggestedMin: 0, suggestedMax: 100, ticks: { display: false }
                        }
                    },
                    plugins: { legend: { display: false } },
                    maintainAspectRatio: false
                }
            });
        }

        function showPokedex() {
            const grid = document.getElementById('pokedex-grid');
            grid.innerHTML = '';
            
            Object.keys(animals).forEach(key => {
                const a = animals[key];
                const card = document.createElement('div');
                card.className = "bg-white rounded-2xl p-4 border border-gray-100 flex gap-4 items-center hover:shadow-lg transition cursor-default";
                card.innerHTML = `
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br ${a.color} flex items-center justify-center text-2xl shadow-md shrink-0 text-white">
                        ${a.icon}
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <h4 class="font-bold text-gray-800 text-sm">${a.name}</h4>
                        </div>
                        <p class="text-[10px] text-gray-400 uppercase tracking-wider mb-2">${a.slogan}</p>
                        <div class="flex gap-1 flex-wrap">
                             ${a.tags.slice(0,2).map(t => `<span class="text-[10px] bg-gray-50 text-gray-500 px-2 py-0.5 rounded-full border border-gray-100">${t}</span>`).join('')}
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
            document.getElementById('page-pokedex').classList.remove('hidden');
        }

        function closePokedex() {
            document.getElementById('page-pokedex').classList.add('hidden');
        }

        window.addEventListener('error', function(e) {
            if (e.target.src && e.target.src.includes('quiz_data')) {
                showError('é¢˜åº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢');
            }
        }, true);
    </script>
</body>
</html>
